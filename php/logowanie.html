<!DOCTYPE html>
<!--
  Mini Projekt Baz Danych
  2ID14B, Przychodnia
-->
<html lang="pl">
  <head>
    <title> PRZYCHODNIA | LOGOWANIE </title>
    <meta charset="UTF-8">
	<link rel="stylesheet" href="css/m_style.css">
	<link rel="stylesheet" href="css/log_style.css">
  </head>
  <body>

    <!-- TO-DO: Styl -->

	
	<div class="error_msg">
	
	<input type="button"
	</div>
	<div class="log_panel">
		<center>
			<form class="log_control">
				<label for="login">Username or email address</label>	<br>
				<input type="text"  autocomplete="off" id="loginArea" class="rounded-input"> <br>
				<label for="passw">Password</label>
				<input type="password"  autocomplete="off" id="passwdArea" class="rounded-input"> <br><br>
			</form>
		  

		  <div id="errOut"></div>
		  <input type="button" value="Zaloguj" id="loginButton" class="rounded-input"> 

		</center>
	</div>
    <div class="reg_panel">
		<a href="rejestracja"> Rejestracja</a>
	</div>

    
	
	<script src="js/api.js"></script>
    <script>

      dbRestrict("Jestes juz zalogowany/zalogowana!", "./konto", ["brak"]);
      
      loginButton.onclick = function(e) 
      {
        const form = {
          login: loginArea.value,
          passwd: passwdArea.value
        }
        
        dbReq((res) =>
        {
          console.log(res);
          if (res.success)
          {
            localStorage.setItem("token", res.token);
            window.location.href = './konto';
          }
          else
          {
			let err_class = document.getElementsByClassName('error_msg');
			err_class[0].style.display= "block";
            err_class[0].textContent = `Nie udalo sie zalogowac: ${res.err}`;
			let c_butt = document.createElement("BUTTON");
			err_class[0].appendChild(c_butt);
          }
        }, "zaloguj", ["user", form.login, "password", form.passwd]);
      }

    </script>

  </body>
</html>